<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uva콏eno - V칳b캩r recept콢</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    
        <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D73VHD89XS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-D73VHD89XS');
    </script>

    <style>
        :root {
            --bg: #1A1A1D;
            --header: #121212;
            --accent: #A7C4C2;
            --white: #ffffff;
            --muted: rgba(255,255,255,0.08);
        }
        
        body {
            background-color: var(--bg);
            color: var(--white);
            font-family: 'Inter', sans-serif;
            /* Zabr치n칤 probliknut칤 nenastylovan칠ho obsahu */
            opacity: 0; 
            visibility: hidden;
        }

        /* Custom Radio Button Styl */
        input[type="radio"]:checked + div {
            border-color: var(--accent);
            background-color: rgba(167, 196, 194, 0.1);
        }
        input[type="radio"]:checked + div .radio-dot {
            background-color: var(--accent);
            transform: scale(1);
        }
        
        aside::-webkit-scrollbar { width: 4px; }
        aside::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-primary': 'var(--bg)',
                        'bg-header': 'var(--header)',
                        'accent': 'var(--accent)',
                        'muted': 'var(--muted)',
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-bg-primary min-h-screen flex flex-col">

    <nav class="bg-bg-header/90 backdrop-blur-md p-4 sticky top-0 z-50 border-b border-white/5 shadow-lg">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <a href="index.html" class="text-2xl md:text-3xl font-extrabold text-accent tracking-wider flex items-center gap-3 hover:text-white transition duration-300 no-underline">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 md:h-9 md:w-9" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h13c0 3-2 6-6.5 6S3 16 3 13z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 13h6" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 7c.5-2-1.5-2-1.5-4M14 7c.5-2-1.5-2-1.5-4" />
                </svg>
                Uva콏eno
            </a>
            <div class="flex items-center space-x-4 md:space-x-8 text-sm md:text-base">
                <a href="index.html" class="text-white/80 hover:text-accent transition duration-300 font-medium no-underline">Dom콢</a>
                <a href="recepty.html" class="text-accent font-bold transition duration-300 font-medium">Recepty</a>
                <a href="pridat-recept.html" class="text-white/80 hover:text-accent transition duration-300 font-medium no-underline">P콏idat Recept</a>
                
                <div class="relative">
                    <button onclick="handleUserIconClick()" class="flex items-center gap-2 text-accent hover:text-white transition focus:outline-none">
                        <div class="p-1 border-2 border-accent rounded-full hover:bg-white/10 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <span id="nav-username" class="font-bold hidden md:block text-sm"></span>
                    </button>

                    <div id="user-menu-content" class="hidden absolute right-0 mt-3 w-48 bg-[#1A1A1D] border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50">
                        <div class="px-4 py-3 border-b border-white/5 bg-white/5">
                            <span class="block text-xs text-white/50 uppercase tracking-wider">P콏ihl치코en jako</span>
                            <span id="menu-username" class="block text-sm font-bold text-white truncate">User</span>
                        </div>
                        
                        <a id="nav-admin-link" href="admin.html" class="block px-4 py-2 text-sm text-yellow-500 hover:bg-white/5 hidden">游녬 Admin Panel</a>
                        <a href="#" class="block px-4 py-2 text-sm text-white/80 hover:text-white hover:bg-white/5 transition">游닀 Moje recepty</a>
                        <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-white/5 transition border-t border-white/5">Odhl치sit se</a>
                    </div>
                </div>

            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto w-full p-4 md:p-8 flex-grow">
        <h1 id="page-title" class="text-4xl font-bold mb-8 text-white border-l-4 border-accent pl-4">V칳b캩r Recept콢</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 relative items-start">
            
            <aside id="sidebar" class="col-span-1 space-y-6 sticky top-28 h-fit max-h-[85vh] overflow-y-auto pr-2 pb-10 opacity-0 -translate-x-10">
                
                <div class="bg-[#222] p-5 rounded-xl border border-white/5 shadow-lg">
                    <h3 class="text-sm uppercase tracking-widest text-white/50 font-bold mb-3 flex items-center gap-2">Hledat</h3>
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Co hled치코, br치코ko?" 
                               class="w-full bg-bg-primary border border-muted rounded-lg p-3 pl-10 text-white focus:outline-none focus:border-accent transition duration-300 text-sm">
                        <svg class="w-4 h-4 text-white/50 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                </div>

                <div class="bg-[#222] p-5 rounded-xl border border-white/5 shadow-lg">
                    <h3 class="text-sm uppercase tracking-widest text-accent font-bold mb-4">Druh chodu</h3>
                    <div class="space-y-2">
                        <label class="cursor-pointer group block">
                            <input type="radio" name="category" value="all" class="hidden filter-radio" checked>
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">V코echno</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group block">
                            <input type="radio" name="category" value="pol칠vka" class="hidden filter-radio">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Pol칠vky</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group block">
                            <input type="radio" name="category" value="hlavn칤" class="hidden filter-radio">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Hlavn칤 chody</span>
                            </div>
                        </label>
                         <label class="cursor-pointer group block">
                            <input type="radio" name="category" value="dezert" class="hidden filter-radio">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Dezerty</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="bg-[#222] p-5 rounded-xl border border-white/5 shadow-lg">
                    <h3 class="text-sm uppercase tracking-widest text-accent font-bold mb-4">Obt칤쬹ost</h3>
                    <div class="space-y-2">
                        <label class="cursor-pointer group block">
                            <input type="radio" name="difficulty" value="all" class="hidden filter-difficulty" checked>
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">V코e</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group block">
                            <input type="radio" name="difficulty" value="snadn치" class="hidden filter-difficulty">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Snadn치</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group block">
                            <input type="radio" name="difficulty" value="st콏edn칤" class="hidden filter-difficulty">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">St콏edn칤</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group block">
                            <input type="radio" name="difficulty" value="t캩쬶치" class="hidden filter-difficulty">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">T캩쬶치</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="bg-[#222] p-5 rounded-xl border border-white/5 shadow-lg">
                    <h3 class="text-sm uppercase tracking-widest text-accent font-bold mb-4">캛as p콏칤pravy</h3>
                    <div class="space-y-2">
                         <label class="cursor-pointer group block">
                            <input type="radio" name="time" value="all" class="hidden filter-time" checked>
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Nez치le쮂</span>
                            </div>
                        </label>
                         <label class="cursor-pointer group block">
                            <input type="radio" name="time" value="30" class="hidden filter-time">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Do 30 min</span>
                            </div>
                        </label>
                         <label class="cursor-pointer group block">
                            <input type="radio" name="time" value="45" class="hidden filter-time">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Do 45 min</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group block">
                            <input type="radio" name="time" value="60" class="hidden filter-time">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Do 1 hod</span>
                            </div>
                        </label>
                         <label class="cursor-pointer group block">
                            <input type="radio" name="time" value="90" class="hidden filter-time">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Do 1.5 hod</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group block">
                            <input type="radio" name="time" value="91" class="hidden filter-time">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">Nad 1.5 hod</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="bg-[#222] p-5 rounded-xl border border-white/5 shadow-lg">
                    <h3 class="text-sm uppercase tracking-widest text-accent font-bold mb-4">Hodnocen칤</h3>
                    <div class="space-y-2">
                        <label class="cursor-pointer group block">
                            <input type="radio" name="rating" value="0" class="hidden filter-rating" checked>
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">V코e</span>
                            </div>
                        </label>
                        <label class="cursor-pointer group block">
                            <input type="radio" name="rating" value="4" class="hidden filter-rating">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">4+ Hv캩zdy</span>
                            </div>
                        </label>
                         <label class="cursor-pointer group block">
                            <input type="radio" name="rating" value="5" class="hidden filter-rating">
                            <div class="flex items-center gap-3 p-2 rounded-lg border border-transparent hover:bg-white/5 transition">
                                <div class="w-4 h-4 rounded-full border border-muted flex items-center justify-center"><div class="radio-dot w-2 h-2 rounded-full bg-transparent transform scale-0 transition duration-200"></div></div>
                                <span class="text-sm text-white/80">5 Hv캩zd</span>
                            </div>
                        </label>
                    </div>
                </div>

                <button onclick="resetFilters()" class="w-full py-3 rounded-lg border border-red-500/30 text-red-400 hover:bg-red-500 hover:text-white transition duration-300 text-sm uppercase tracking-wider font-bold">
                    Zru코it filtry
                </button>

            </aside>

            <section class="col-span-1 lg:col-span-3 pb-20">
                <div id="recipes-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    </div>
                
                <div id="empty-state" class="hidden text-center py-20 bg-[#222] rounded-xl border border-white/5 border-dashed">
                    <svg class="w-16 h-16 mx-auto text-white/20 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <p class="text-xl text-white/50">Takovou dobrotu jsme zat칤m neuva콏ili.</p>
                    <p class="text-sm text-white/30 mt-2">Zkus uvolnit filtry, br치코ko.</p>
                </div>
            </section>

        </div>
    </div>

    <footer class="bg-bg-header py-6 text-center text-white/40 border-t border-white/5 text-sm mt-auto">
        <p>&copy; 2025 Uva콏eno. Br치코ko, tohle je top projekt.</p>
    </footer>

    <script>
        // --- 1. FUNKCE PRO NA캛TEN칈 DAT Z BACKENDU ---
        async function fetchRecipes() {
            try {
                // Vol치me n치코 Python backend
                const response = await fetch('/api/recipes'); 
                const data = await response.json();
                
                // Zavol치me funkci pro vykreslen칤 s daty z datab치ze
                renderRecipes(data);
                
                // Ulo쮂셠e data bokem pro filtrov치n칤
                window.allRecipes = data; 

            } catch (error) {
                console.error("Chyba p콏i stahov치n칤 recept콢:", error);
                document.getElementById('recipes-grid').innerHTML = '<p class="text-white text-center w-full col-span-2">Nepoda콏ilo se na캜칤st recepty. Zkontroluj, jestli b캩쮂 backend (app.py).</p>';
            }
        }

        // --- 2. VYKRESLOV츼N칈 RECEPT콡 ---
        const grid = document.getElementById('recipes-grid');
        const emptyState = document.getElementById('empty-state');

        function renderRecipes(data) {
            grid.innerHTML = '';
            
            if(data.length === 0) {
                emptyState.classList.remove('hidden');
                gsap.fromTo(emptyState, { opacity: 0, y: 10 }, { opacity: 1, y: 0, duration: 0.5 });
                return;
            } else {
                emptyState.classList.add('hidden');
            }

            data.forEach((recipe, index) => {
                // Pozor: Cesta k obr치zku z DB u obsahuje "static/...", ale v HTML mus칤me d치t pozor na lom칤tka
                // Pokud obr치zek chyb칤, d치me placeholder
                const imgUrl = recipe.image ? recipe.image : 'https://images.unsplash.com/photo-1495521821758-ee18ece6d660?q=80&w=500';

                const card = document.createElement('a');
                card.href = `detail.html?id=${recipe.id}`;
                card.className = 'recipe-card block bg-[#222] rounded-2xl overflow-hidden border border-white/5 hover:border-accent transition duration-300 shadow-xl flex flex-col-reverse sm:flex-row h-auto sm:h-48 group cursor-pointer transform hover:-translate-y-1 opacity-0'; 
                
                // TADY JSEM UD캨LAL TU ZM캨NU: line-clamp-2 a leading-tight
                card.innerHTML = `
                    <div class="p-5 flex flex-col justify-between flex-1">
                        <div>
                            <div class="flex justify-between items-start">
                                <h3 class="text-xl font-bold text-white group-hover:text-accent transition line-clamp-2 leading-tight pr-2">${recipe.name}</h3>
                                <span class="text-xs uppercase tracking-wider text-white/40 border border-white/10 px-2 py-1 rounded-md whitespace-nowrap">${recipe.difficulty}</span>
                            </div>
                            <div class="flex mt-2 mb-4 space-x-0.5">
                                ${getStars(recipe.rating)}
                            </div>
                        </div>

                        <div class="flex items-center gap-4 text-sm text-white/60">
                            <div class="flex items-center gap-1 text-accent">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                ${formatTime(recipe.time)}
                            </div>
                            <div class="w-1 h-1 bg-white/20 rounded-full"></div>
                            <span class="capitalize">${recipe.category}</span>
                        </div>
                    </div>
                    <div class="w-full sm:w-1/3 h-40 sm:h-auto relative overflow-hidden">
                        <div class="absolute inset-0 bg-cover bg-center transition duration-700 transform group-hover:scale-110" 
                             style="background-image: url('${imgUrl}');"></div>
                        <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition"></div>
                    </div>
                `;
                grid.appendChild(card);

                gsap.fromTo(card, 
                    { y: 30, opacity: 0 },
                    { y: 0, opacity: 1, duration: 0.5, delay: index * 0.1, ease: "power2.out" }
                );
            });
        }

        // --- HELPER FUNKCE ---
        function formatTime(min) {
            const minutes = parseInt(min); 
            if(!minutes) return 'N/A';
            if(minutes < 60) return `${minutes} min`;
            const h = Math.floor(minutes / 60);
            const m = minutes % 60;
            return m > 0 ? `${h}h ${m}m` : `${h}h`;
        }

        function getStars(count) {
            let stars = '';
            for(let i=0; i<5; i++) {
                let colorClass = i < count ? 'text-yellow-500' : 'text-white/20';
                stars += `<svg class="w-4 h-4 ${colorClass} fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`;
            }
            return stars;
        }

        // --- FILTROV츼N칈 ---
        const searchInput = document.getElementById('search-input');
        
        function getCheckedValue(name) {
            const el = document.querySelector(`input[name="${name}"]:checked`);
            return el ? el.value : 'all';
        }

        function filterData() {
            // Pou쮂셨치me data sta쬰n치 z DB
            if (!window.allRecipes) return;

            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedCategory = getCheckedValue('category');
            const selectedDifficulty = getCheckedValue('difficulty');
            const selectedTime = getCheckedValue('time');
            const selectedRating = parseInt(getCheckedValue('rating'));

            const filtered = window.allRecipes.filter(item => {
                const matchSearch = item.name.toLowerCase().includes(searchTerm);
                const matchCategory = selectedCategory === 'all' || item.category === selectedCategory;
                const matchDiff = selectedDifficulty === 'all' || item.difficulty === selectedDifficulty;
                const matchRating = item.rating >= selectedRating;

                let matchTime = true;
                if(selectedTime !== 'all') {
                    const t = parseInt(selectedTime);
                    const itemTime = parseInt(item.time);
                    if(!itemTime) { matchTime = true; } 
                    else if(t === 91) { matchTime = itemTime > 90; } 
                    else { matchTime = itemTime <= t; }
                }

                return matchSearch && matchCategory && matchDiff && matchRating && matchTime;
            });

            renderRecipes(filtered);
        }

        searchInput.addEventListener('input', filterData);
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', filterData);
        });

        window.resetFilters = function() {
            searchInput.value = '';
            document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
            // Nastav칤me defaulty
            document.querySelector('input[name="category"][value="all"]').checked = true;
            document.querySelector('input[name="time"][value="all"]').checked = true;
            document.querySelector('input[name="rating"][value="0"]').checked = true;
            document.querySelector('input[name="difficulty"][value="all"]').checked = true;
            filterData();
        }

        // --- PAGE INTRO ---
        window.addEventListener('load', () => {
            gsap.to("body", { autoAlpha: 1, duration: 0.5 });
            gsap.to("#sidebar", { x: 0, opacity: 1, duration: 0.8, ease: "power3.out", delay: 0.2 });
            gsap.from("#page-title", { y: -30, opacity: 0, duration: 0.8, ease: "power3.out", delay: 0.1 });
            
            // TADY TO SPUST칈ME: St치hnout data z DB
            fetchRecipes();
        });

        // Glob치ln칤 prom캩nn치 pro stav p콏ihl치코en칤
        let isUserLoggedIn = false;

        // --- 1. Zjistit stav p콏i na캜ten칤 ---
        async function checkLoginStatus() {
            try {
                const response = await fetch('/api/me');
                const data = await response.json();

                const navUsername = document.getElementById('nav-username');
                const menuUsername = document.getElementById('menu-username');
                const adminLink = document.getElementById('nav-admin-link');

                if (data.logged_in) {
                    isUserLoggedIn = true;
                    
                    // Zobraz칤me jm칠no vedle ikonky
                    if(navUsername) {
                        navUsername.textContent = data.jmeno;
                        navUsername.classList.remove('hidden'); 
                    }
                    if(menuUsername) menuUsername.textContent = data.jmeno;

                    // Pokud je admin, uk치zat odkaz
                    if (data.role === 'admin' && adminLink) {
                        adminLink.classList.remove('hidden');
                    }
                } else {
                    isUserLoggedIn = false;
                    // Skryjeme jm칠no, nech치me jen ikonku
                    if(navUsername) navUsername.classList.add('hidden');
                }
            } catch (error) {
                console.error("Chyba p콏i kontrole p콏ihl치코en칤:", error);
            }
        }

        // --- 2. Co se stane po kliknut칤 na pandul치ka ---
        function handleUserIconClick() {
            if (isUserLoggedIn) {
                // Je p콏ihl치코en -> Otev콏i/Zav콏i menu
                toggleUserMenu();
            } else {
                // Nen칤 p콏ihl치코en -> Jdi na login
                window.location.href = 'login.html';
            }
        }

        function toggleUserMenu() {
            const menu = document.getElementById('user-menu-content');
            menu.classList.toggle('hidden');
            
            if (!menu.classList.contains('hidden')) {
                gsap.fromTo(menu, { opacity: 0, y: -10 }, { opacity: 1, y: 0, duration: 0.2 });
            }
        }

        // Zav콏칤t menu kliknut칤m jinam
        window.addEventListener('click', function(e) {
            const menu = document.getElementById('user-menu-content');
            // Mus칤me zkontrolovat, jestli neklik치me na tla캜칤tko s ikonkou
            const btn = document.querySelector('button[onclick="handleUserIconClick()"]');
            
            if (menu && !menu.classList.contains('hidden') && !menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        // --- 3. Odhl치코en칤 ---
        async function logout() {
            await fetch('/api/logout');
            window.location.href = "index.html"; 
        }

        window.addEventListener('load', () => {
            checkLoginStatus();
            // Zde p콏칤padn캩 dal코칤 init funkce
        });
    </script>
</body>
</html>