<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P≈ôihl√°≈°en√≠ - Uva≈ôeno</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    
    <style>
        :root {
            --bg: #1A1A1D;
            --header: #121212;
            --accent: #A7C4C2;
            --btn-bg: #2C4251;
            --white: #ffffff;
            --muted: rgba(255,255,255,0.08);
        }
        
        body {
            background-color: var(--bg);
            color: var(--white);
            font-family: 'Inter', sans-serif;
            /* SMAZ√ÅNO OMEZEN√ç V√ù≈†KY - TEƒé SE TO NEU≈ò√çZNE */
        }

        /* Styl input≈Ø */
        .auth-input {
            background-color: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            width: 100%;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .auth-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(167, 196, 194, 0.1);
        }

        /* Toggle Switch */
        .toggle-container {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 4px;
            display: flex;
            position: relative;
        }

        .toggle-btn {
            flex: 1;
            text-align: center;
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .toggle-btn.active {
            background-color: var(--btn-bg);
            color: var(--accent);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .toggle-btn.inactive {
            color: rgba(255, 255, 255, 0.5);
        }
        .toggle-btn.inactive:hover { color: white; }

        /* Submit Button - V√ùRAZN√ù */
        .btn-submit {
            background-color: var(--btn-bg);
            color: var(--accent);
            font-weight: 800;
            padding: 1.2rem; /* Vƒõt≈°√≠ padding */
            border-radius: 0.5rem;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            border: 2px solid transparent;
            cursor: pointer;
            display: block; /* Pro jistotu */
        }
        .btn-submit:hover {
            background-color: var(--accent);
            color: var(--btn-bg);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(167, 196, 194, 0.2);
        }

        .image-overlay {
            background: linear-gradient(to right, rgba(26,26,29,0.9), rgba(26,26,29,0.3));
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--header); }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-primary': 'var(--bg)',
                        'bg-header': 'var(--header)',
                        'accent': 'var(--accent)',
                        'muted': 'var(--muted)',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-bg-header/90 backdrop-blur-md p-4 sticky top-0 z-50 border-b border-white/5 shadow-lg">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <a href="index.html" class="text-2xl md:text-3xl font-extrabold text-accent tracking-wider flex items-center gap-3 hover:text-white transition duration-300 no-underline">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 md:h-9 md:w-9" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h13c0 3-2 6-6.5 6S3 16 3 13z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 13h6" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 7c.5-2-1.5-2-1.5-4M14 7c.5-2-1.5-2-1.5-4" />
                </svg>
                Uva≈ôeno
            </a>
            <div class="flex items-center space-x-4 md:space-x-8 text-sm md:text-base">
                <a href="index.html" class="text-white/80 hover:text-accent transition duration-300 font-medium no-underline">Dom≈Ø</a>
                <a href="recepty.html" class="text-white/80 hover:text-accent transition duration-300 font-medium no-underline">Recepty</a>
                <a href="pridat-recept.html" class="text-white/80 hover:text-accent transition duration-300 font-medium no-underline">P≈ôidat Recept</a>
                
                <div class="relative">
                    <button onclick="handleUserIconClick()" class="flex items-center gap-2 text-accent hover:text-white transition focus:outline-none">
                        <div class="p-1 border-2 border-accent rounded-full hover:bg-white/10 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <span id="nav-username" class="font-bold hidden md:block text-sm"></span>
                    </button>

                    <div id="user-menu-content" class="hidden absolute right-0 mt-3 w-48 bg-[#1A1A1D] border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50">
                        <div class="px-4 py-3 border-b border-white/5 bg-white/5">
                            <span class="block text-xs text-white/50 uppercase tracking-wider">P≈ôihl√°≈°en jako</span>
                            <span id="menu-username" class="block text-sm font-bold text-white truncate">User</span>
                        </div>
                        
                        <a id="nav-admin-link" href="admin.html" class="block px-4 py-2 text-sm text-yellow-500 hover:bg-white/5 hidden">üëë Admin Panel</a>
                        <a href="#" class="block px-4 py-2 text-sm text-white/80 hover:text-white hover:bg-white/5 transition">üìñ Moje recepty</a>
                        <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-white/5 transition border-t border-white/5">Odhl√°sit se</a>
                    </div>
                </div>

            </div>
        </div>
    </nav>

    <main class="flex-grow grid grid-cols-1 lg:grid-cols-2 min-h-screen pt-20 lg:pt-0">
        
        <div class="relative hidden lg:flex items-center justify-center overflow-hidden min-h-screen fixed-left">
            <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1414235077428-338989a2e8c0?auto=format&fit=crop&q=80');"></div>
            <div class="absolute inset-0 image-overlay"></div>

            <div class="relative z-10 p-12 max-w-2xl">
                <h1 id="left-heading" class="text-5xl lg:text-7xl font-extrabold text-white leading-tight mb-6 drop-shadow-2xl">
                    Vstupte do svƒõta chut√≠ s Uva≈ôeno.
                </h1>
            </div>
        </div>

        <div class="flex items-center justify-center bg-[#121212] px-6 py-20 lg:px-20">
            
            <div class="w-full max-w-md space-y-8">
                
                <div class="flex flex-col items-center gap-6">
                    <div class="p-5 bg-[#2C4251]/20 rounded-full border-2 border-[#2C4251]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h13c0 3-2 6-6.5 6S3 16 3 13z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 13h6" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 7c.5-2-1.5-2-1.5-4M14 7c.5-2-1.5-2-1.5-4" />
                        </svg>
                    </div>
                    <h2 id="form-title" class="text-3xl font-bold text-white tracking-wider">P≈ôihl√°sit se</h2>
                </div>

                <div class="toggle-container">
                    <div id="btn-login-switch" onclick="switchMode('login')" class="toggle-btn active">P≈ôihl√°≈°en√≠</div>
                    <div id="btn-register-switch" onclick="switchMode('register')" class="toggle-btn inactive">Registrace</div>
                </div>

                <form id="login-form" class="space-y-6" onsubmit="event.preventDefault();">
                    <div class="space-y-4">
                        <input type="text" placeholder="U≈æivatelsk√© jm√©no" class="auth-input">
                        <input type="password" placeholder="Heslo" class="auth-input">
                    </div>
                    
                    <button type="submit" class="btn-submit mt-8 shadow-xl">
                        P≈ôihl√°sit se
                    </button>
                </form>

                <form id="register-form" class="space-y-6 hidden" onsubmit="event.preventDefault();">
                    <div class="space-y-4">
                        <input type="text" placeholder="U≈æivatelsk√© jm√©no" class="auth-input">
                        <input type="email" placeholder="Email" class="auth-input">
                        <input type="password" placeholder="Heslo" class="auth-input">
                    </div>
                    
                    <button type="submit" class="btn-submit mt-8 shadow-xl">
                        Registrovat se
                    </button>
                </form>

            </div>
        </div>
    </main>

    <script>
        const texts = {
            login: "Vstupte do svƒõta chut√≠ s Uva≈ôeno.",
            register: "Zaregistrujte se a inspirujte se recepty."
        };

        const leftHeading = document.getElementById('left-heading');
        const formTitle = document.getElementById('form-title');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const btnLogin = document.getElementById('btn-login-switch');
        const btnRegister = document.getElementById('btn-register-switch');

        // --- ANIMACE P≈òI NAƒåTEN√ç ---
        window.addEventListener('load', () => {
            gsap.from("main > div", { opacity: 0, duration: 1, stagger: 0.2 });
        });

        // --- P≈òEP√çN√ÅN√ç RE≈ΩIM≈Æ (UI) ---
        function switchMode(mode) {
            if (mode === 'login') {
                btnLogin.classList.add('active');
                btnLogin.classList.remove('inactive');
                btnRegister.classList.remove('active');
                btnRegister.classList.add('inactive');
                animateTextChange("P≈ôihl√°sit se", texts.login);
                toggleForms(registerForm, loginForm);
            } else {
                btnRegister.classList.add('active');
                btnRegister.classList.remove('inactive');
                btnLogin.classList.remove('active');
                btnLogin.classList.add('inactive');
                animateTextChange("Registrovat se", texts.register);
                toggleForms(loginForm, registerForm);
            }
        }

        function animateTextChange(newTitle, newLeftText) {
            gsap.to(formTitle, { opacity: 0, y: -10, duration: 0.2, onComplete: () => {
                formTitle.textContent = newTitle;
                gsap.to(formTitle, { opacity: 1, y: 0, duration: 0.3 });
            }});

            gsap.to(leftHeading, { opacity: 0, x: -20, duration: 0.3, onComplete: () => {
                leftHeading.textContent = newLeftText;
                gsap.to(leftHeading, { opacity: 1, x: 0, duration: 0.4, ease: "power2.out" });
            }});
        }

        function toggleForms(hideForm, showForm) {
            gsap.to(hideForm, { opacity: 0, height: 0, duration: 0.3, onComplete: () => {
                hideForm.classList.add('hidden');
                hideForm.style.height = 'auto';
                showForm.classList.remove('hidden');
                gsap.fromTo(showForm, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.4, clearProps: "all" });
            }});
        }

        // --- LOGIKA P≈òIHL√Å≈†EN√ç ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const inputs = loginForm.querySelectorAll('input');
            const jmeno = inputs[0].value;
            const heslo = inputs[1].value;
            const btn = loginForm.querySelector('button');

            try {
                btn.textContent = "P≈ôihla≈°uji...";
                btn.disabled = true;

                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ jmeno, heslo })
                });
                const data = await response.json();

                if (data.success) {
                    // P≈ôesmƒõrov√°n√≠ podle role
                    if (data.role === 'admin') window.location.href = "admin.html";
                    else window.location.href = "index.html";
                } else {
                    alert("‚ùå " + data.message);
                    btn.textContent = "P≈ôihl√°sit se";
                    btn.disabled = false;
                }
            } catch (error) {
                console.error(error);
                alert("Chyba p≈ôipojen√≠ k serveru.");
                btn.textContent = "P≈ôihl√°sit se";
                btn.disabled = false;
            }
        });

        // --- LOGIKA REGISTRACE ---
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const inputs = registerForm.querySelectorAll('input');
            const jmeno = inputs[0].value;
            const email = inputs[1].value;
            const heslo = inputs[2].value;
            const btn = registerForm.querySelector('button');

            try {
                btn.textContent = "Registruji...";
                btn.disabled = true;

                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ jmeno, email, heslo })
                });
                const data = await response.json();

                if (data.success) {
                    alert("‚úÖ " + data.message);
                    location.reload(); // Reload str√°nky pro p≈ôihl√°≈°en√≠
                } else {
                    alert("‚ùå " + data.message);
                    btn.textContent = "Registrovat se";
                    btn.disabled = false;
                }
            } catch (error) {
                console.error(error);
                alert("Chyba p≈ôipojen√≠ k serveru.");
                btn.textContent = "Registrovat se";
                btn.disabled = false;
            }
        });

        // Glob√°ln√≠ promƒõnn√° pro stav p≈ôihl√°≈°en√≠
        let isUserLoggedIn = false;

        // --- 1. Zjistit stav p≈ôi naƒçten√≠ ---
        async function checkLoginStatus() {
            try {
                const response = await fetch('/api/me');
                const data = await response.json();

                const navUsername = document.getElementById('nav-username');
                const menuUsername = document.getElementById('menu-username');
                const adminLink = document.getElementById('nav-admin-link');

                if (data.logged_in) {
                    isUserLoggedIn = true;
                    
                    // Zobraz√≠me jm√©no vedle ikonky
                    if(navUsername) {
                        navUsername.textContent = data.jmeno;
                        navUsername.classList.remove('hidden'); 
                    }
                    if(menuUsername) menuUsername.textContent = data.jmeno;

                    // Pokud je admin, uk√°zat odkaz
                    if (data.role === 'admin' && adminLink) {
                        adminLink.classList.remove('hidden');
                    }
                } else {
                    isUserLoggedIn = false;
                    // Skryjeme jm√©no, nech√°me jen ikonku
                    if(navUsername) navUsername.classList.add('hidden');
                }
            } catch (error) {
                console.error("Chyba p≈ôi kontrole p≈ôihl√°≈°en√≠:", error);
            }
        }

        // --- 2. Co se stane po kliknut√≠ na pandul√°ka ---
        function handleUserIconClick() {
            if (isUserLoggedIn) {
                // Je p≈ôihl√°≈°en -> Otev≈ôi/Zav≈ôi menu
                toggleUserMenu();
            } else {
                // Nen√≠ p≈ôihl√°≈°en -> Jdi na login
                window.location.href = 'login.html';
            }
        }

        function toggleUserMenu() {
            const menu = document.getElementById('user-menu-content');
            menu.classList.toggle('hidden');
            
            if (!menu.classList.contains('hidden')) {
                gsap.fromTo(menu, { opacity: 0, y: -10 }, { opacity: 1, y: 0, duration: 0.2 });
            }
        }

        // Zav≈ô√≠t menu kliknut√≠m jinam
        window.addEventListener('click', function(e) {
            const menu = document.getElementById('user-menu-content');
            // Mus√≠me zkontrolovat, jestli neklik√°me na tlaƒç√≠tko s ikonkou
            const btn = document.querySelector('button[onclick="handleUserIconClick()"]');
            
            if (menu && !menu.classList.contains('hidden') && !menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        // --- 3. Odhl√°≈°en√≠ ---
        async function logout() {
            await fetch('/api/logout');
            window.location.href = "index.html"; 
        }

        window.addEventListener('load', () => {
            checkLoginStatus();
            // Zde p≈ô√≠padnƒõ dal≈°√≠ init funkce
        });
    </script>
</body>
</html>